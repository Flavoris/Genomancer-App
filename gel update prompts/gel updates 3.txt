Goal: Centralize the physics-ish mapping and make it respond to gel %. We’ll use a practical approximation:

Relative mobility follows a semi-log relation: Rf = a - b * log10(bp)

b grows with agarose% (higher% = stronger size separation & slower migration).

Actions:

1. Add a new file Sources/Features/Gel/GelLayout.swift with:

import CoreGraphics
import Foundation

enum GelLayout {
    /// Empirical slope adjustment: higher % agarose -> steeper log slope (bands stay higher).
    /// Tuned to be gentle and visually plausible without real calibration curves.
    static func slope(forGelPercent p: Double) -> Double {
        // Baseline 1.5% ≈ 1.0 slope. Each +0.5% adds ~0.12.
        // Clamp to avoid absurd values in UI.
        let clamped = max(0.5, min(4.0, p))
        return 1.0 + 0.24 * (clamped - 1.5) // 1.0 at 1.5%, ~0.88 at 1.0%, ~1.12 at 2.0%, ~1.36 at 3.0%
    }

    /// Semi-log bp -> y mapping with gel% slope.
    /// yTop at largest bp, yTop+height at smallest bp.
    static func y(bp: Int, minBP: Int, maxBP: Int, yTop: CGFloat, height: CGFloat, gelPercent: Double) -> CGFloat {
        let bpv = max(1, bp)
        let loMin = log10(Double(max(1, minBP)))
        let loMax = log10(Double(max(maxBP, minBP + 1)))
        let span  = max(1e-6, loMax - loMin)
        let t     = (log10(Double(bpv)) - loMin) / span  // 0..1 for min..max
        // Apply slope: raise t to a power >1 for steeper compression at top
        let s = slope(forGelPercent: gelPercent)
        let ts = pow(t, s)
        return yTop + (1 - ts) * height
    }
}


2. In GelRenderView, replace the inline y-math with a call to GelLayout.y(...).

3. Minor polish: make thin bands at higher gel% (e.g., multiply your coreHeight by max(0.8, 1.1 - 0.08*(gelPercent-1.5))).